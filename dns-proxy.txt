Prerequisites

Server Side: Ensure the Ansible playbook has been run with the custom sslh build and iodine MASQUERADE rules.
Client Side: iodine installed (brew install iodine), Proxy SwitchyOmega extension installed in Chrome.


1. Start the DNS Tunnel
-----------------------

Open a terminal and run the optimized Iodine client. This creates the raw network pipe over DNS.

-I1: Forces a 1-second interval to reduce packet jitter.

-L0: Disables "lazy mode" to keep the connection responsive.

sudo iodine -f -P fence-embark-CORTEX -I1 -L0 t.matthewcarroll.ca

Keep this terminal window open.


2. Route Traffic to the Docker Host
-----------------------------------
Open a new terminal tab. You need to tell your computer how to reach the server's internal Docker IP (172.18.0.1) by sending packets through the Iodine tunnel (10.200.0.1).

sudo route add 172.18.0.1 10.200.0.1


3. Start the SOCKS Proxy (SSH)
------------------------------
Establish the secure SSH connection through the tunnel and open the local proxy port (9090).

Note: This command will appear to "hang" (no output). This is normal. Do not close it.

ssh -N -D 9090 -i ~/.ssh/id_ed25519_gcp dev@172.18.0.1


4. Activate Browser Proxy
-------------------------
Open Chrome (with Proxy SwitchyOmega installed).

Click the extension icon and select your Stealth profile.

Config: Protocol: SOCKS5, Server: 127.0.0.1, Port: 9090.

Critical: Ensure "Proxy DNS" is enabled in the profile settings.

Browse to https://ipinfo.io to verify you are appearing as your GCP server.


Troubleshooting
---------------

Stuttering/Slow: The DNS tunnel is inherently slow. If it freezes, check the iodine terminal for "Retrying..." messages.

SSH Timeout: If SSH times out, verify the route is still active (netstat -rn | grep 172.18.0.1) and that the iodine window is still running.

"Resource Busy" in Iodine: Harmless on macOS; it's just finding an available VPN slot.